generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum DayOfWeek {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

enum TeacherPosition {
  DepartmentProfessor
  Professor
  AssociateProfessor
  SeniorLecturer
  Assistant
}

enum RepeatType {
  Daily
  Weekly
  Monthly
}

enum SubjectType {
  Lecture
  Practice
}

model Group {
  id       Int    @id @default(autoincrement())
  name     String
  subGroup Int    @map("sub_group")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  users   User[]
  classes Class[]

  @@map("groups")
}

model User {
  id       Int     @id @default(autoincrement())
  chatId   BigInt  @map("chat_id")
  username String?
  nickname String?
  groupId  Int     @map("group_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  group Group @relation(fields: [groupId], references: [id])

  @@map("users")
}

model Subject {
  id   Int         @id @default(autoincrement())
  name String
  type SubjectType

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  classes Class[]

  @@map("subjects")
}

model Teacher {
  id       Int             @id @default(autoincrement())
  name     String
  position TeacherPosition

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  classes Class[]

  @@map("teachers")
}

model Audience {
  id   Int    @id @default(autoincrement())
  name String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  classes Class[]

  @@map("audiences")
}

model Class {
  id         Int      @id @default(autoincrement())
  subjectId  Int
  teacherId  Int
  audienceId Int
  groupId    Int
  startTime  DateTime @map("start_time")
  duration   Int

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  subject  Subject  @relation(fields: [subjectId], references: [id])
  teacher  Teacher  @relation(fields: [teacherId], references: [id])
  audience Audience @relation(fields: [audienceId], references: [id])
  group    Group    @relation(fields: [groupId], references: [id])

  schedules ClassRecurrence[]

  @@map("classes")
}

model ClassRecurrence {
  id          Int        @id @default(autoincrement())
  classId     Int
  startDate   DateTime   @map("start_date")
  endDate     DateTime   @map("end_date")
  repeatType  RepeatType @map("repeat_type")
  repeatValue Int        @map("repeat_value")

  class Class @relation(fields: [classId], references: [id])

  @@map("class_recurrences")
}
