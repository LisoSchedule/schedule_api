generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum DayOfWeek {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

enum TeacherPosition {
  Assistant
  AssociateProfessor
  Professor
}

enum RepeatType {
  Daily
  Weekly
  Monthly
}

enum SubjectType {
  Lecture
  Practice
}

enum UserStep {
  ChooseNickname
  ChoosingNickname
  ChooseGroup
  ChooseSubGroup
  MainMenu
}

model Group {
  id       Int    @id @default(autoincrement())
  name     String
  subGroup Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users   User[]
  classes Class[]
}

model User {
  id        Int      @id @default(autoincrement())
  chatId    BigInt
  username  String?
  nickname  String?
  groupId   Int
  step      UserStep
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  group Group @relation(fields: [groupId], references: [id])
}

model Subject {
  id   Int         @id @default(autoincrement())
  name String
  type SubjectType

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  classes   Class[]
}

model Teacher {
  id       Int             @id @default(autoincrement())
  name     String
  position TeacherPosition

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  classes Class[]
}

model Audience {
  id   Int    @id @default(autoincrement())
  name String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  classes Class[]
}

model Class {
  id         Int      @id @default(autoincrement())
  subjectId  Int
  teacherId  Int
  audienceId Int
  groupId    Int
  start_time DateTime
  duration   Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  subject  Subject  @relation(fields: [subjectId], references: [id])
  teacher  Teacher  @relation(fields: [teacherId], references: [id])
  audience Audience @relation(fields: [audienceId], references: [id])
  group    Group    @relation(fields: [groupId], references: [id])

  schedules ClassesSchedule[]
}

model ClassesSchedule {
  id           Int        @id @default(autoincrement())
  classId      Int
  start_date   DateTime
  end_date     DateTime
  repeat_type  RepeatType
  repeat_value Int

  class Class @relation(fields: [classId], references: [id])
}
